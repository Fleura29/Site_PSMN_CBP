.. _lammps:

LAMMPS
======

+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|  Version                  |  Compilateur                 |  Interconnexion  |  chemin d'accès                                                                     |  OS        |
+===========================+==============================+==================+=====================================================================================+============+
|  11Nov13                  |  openmpi-1.6.4-intel-14.0.1  |  Infiniband      | /applis/PSMN/debian7/Lammps-11Nov13/intel-14.0.1/openmpi-1.6.4/bin/lammps           |  Debian 7  |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|                           | **modèle tsch** : /applis/PSMN/modeles/Lammps-11Nov13-debian7.csh                                                                                  |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|                           | **modèle bash** : /applis/PSMN/modeles/Lammps-11Nov13-debian7.sh                                                                                   |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|                           | **modulefile** : Lammps/11Nov13-mpi-1.6.4-intel-14.0.1                                                                                             |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|  28Jun14                  |  openmpi-1.6.4-intel-14.0.1  |  Infiniband      | /applis/PSMN/debian7/Lammps/28Jun14/intel-14.0.1/openmpi-1.6.4/bin/lammps           |  Debian 7  |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|                           | **modèle tsch** : /applis/PSMN/modeles/Lammps-28Jun14-debian7.csh                                                                                  |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|                           | **modèle bash** : /applis/PSMN/modeles/Lammps-28Jun14-debian7.sh                                                                                   |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|                           | **modulefile** : Lammps/28Jun14-mpi-1.6.4-intel-14.0.1                                                                                             |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|  28Jun14                  |  openmpi-1.8.4-intel-14.0.1  |  Infiniband      | /applis/PSMN/debian7/Lammps/28Jun14/intel-14.0.1/openmpi-1.8.4/bin/lammps           |  Debian 7  |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|                           | **modulefile** : Lammps/28Jun14-mpi-1.8.4-intel-14.0.1                                                                                             |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|  15May15                  |  openmpi-1.8.4-intel-14.0.1  |  Infiniband      | /applis/PSMN/debian7/Lammps/15May15/intel-14.0.1/openmpi-1.8.4/bin/lammps           |  Debian 7  |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|                           | **modulefile** : Lammps/15May15-mpi-1.8.4-intel-14.0.1                                                                                             |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|  7Dec15                   |  openmpi-1.8.4-intel-14.0.1  |  Infiniband      | /applis/PSMN/debian7/Lammps/7Dec15/intel-14.0.1/openmpi-1.8.4/bin/lammps            |  Debian 7  |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|                           | **modulefile** : Lammps/7Dec15-mpi-1.8.4-intel-14.0.1                                                                                              |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|  11Aug17                  |  openmpi-3.0.0-intel/2017.4  |  Infiniband      | /applis/PSMN/debian9/software/Local/LAMMPS/11Aug17/iomkl-2017.4b-3.0.0/bin/         |  Debian 7  |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|                           | **modulefile** : LAMMPS/11Aug17-iomkl-2017.4-3.0.0                                                                                                 |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|  22Aug2018                |  openmpi-3.0.0-intel/2017.4  |  Infiniband      | /applis/PSMN/debian9/software/Local/LAMMPS/22Aug2018/iomkl-2017.4b-3.0.0/bin/       |  Debian 9  |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|                           | **modulefile** : LAMMPS/22Aug2018-iomkl-2017.4-3.0.0                                                                                               |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|  15Nov2018                |  openmpi-3.0.0-intel/2017.4  |  Infiniband      | /applis/PSMN/debian9/software/Local/LAMMPS/15Nov2018/iomkl-2017.4b-3.0.0/bin/       |  Debian 9  |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|                           | **modulefile** : LAMMPS/15Nov2018-iomkl-2017.4-3.0.0                                                                                               |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|  19Sep2019                |  openmpi-3.0.0-intel/2017.4  |  Infiniband      | /applis/PSMN/debian9/software/Local/LAMMPS/19Sep19/iomkl-2017.4-3.0.0/bin/          |  Debian 9  |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|                           | **modulefile** : LAMMPS/19Sep2019-iomkl-2017.4-3.0.0                                                                                               |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|  3Mar20                   |  openmpi-3.0.0-intel/2017.4  |  Infiniband      | /applis/PSMN/debian9/software/Local/LAMMPS/3Mar20/iomkl-2017.4-3.0.0/bin/           |  Debian 9  |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|                           | **modulefile** : LAMMPS/3Mar20-iomkl-2017.4-3.0.0                                                                                                  |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|  3Mar20 avec GAP et QUIP  |  openmpi-3.0.0-intel/2017.4  |  Infiniband      | /applis/PSMN/debian9/software/Local/LAMMPS/3Mar20-quip-gap/iomkl-2017.4-3.0.0/bin/  |  Debian 9  |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+
|                           | **modulefile** : LAMMPS/3Mar20-quip-gap-iomkl-2017.4-3.0.0                                                                                         |
+---------------------------+------------------------------+------------------+-------------------------------------------------------------------------------------+------------+

.. container:: note note-important

    Pour utiliser les modules, consulter `Environment Modules <#>`_

* Chemin d'installation (pour la doc, exemples, etc.) : 

.. code-block:: bash
    
    /applis/PSMN/debian7/Lammps/28Jun14/intel-14.0.1/openmpi-1.6.4

* Test de fonctionnement (version 28Jun14)

.. code-block:: bash

   $ cp -r /applis/PSMN/debian7/Lammps/28Jun14/intel-14.0.1/openmpi-1.8.4/bench/ /home/nom_login/bench_lammps
   $ cd /home/nom_login/bench_lammps
   $ source /usr/share/modules/init/tcsh # éventuellement (si pas déjà fait) ; pour un autre shell (bash) utiliser le fichier correspondant
   $ module use /applis/PSMN/Modules     # éventuellement (si pas déjà fait)
   $ module load Base/psmn               # éventuellement (si pas déjà fait)
   $ module load Lammps/28Jun14-mpi-1.8.4-intel-14.0.1
   $ mpirun -np 4 lammps < in.lj > log.out

Vous pouvez alors consulter le fichier log.out (et le fichier log.lammps).
Dans ce qui précède, remplacer nom_login par votre login PSMN, le shell utilisé est tcsh (ou csh) et on charge le modulefile 'Lammps/28Jun14-mpi-1.8.4-intel-14.0.1' pour configurer l'environnement d'éxecution.

Doc admin-sys PSMN
------------------

LAMMPS_28Jun14
~~~~~~~~~~~~~~

* Construction avec Intel 14.0.1 et OpenMPI 1.6.4

.. code-block:: bash

    cd lammps-28Jun14
    cp MAKE/Makefile.linux MAKE/Makefile.openmpi-1.6.4-intel-14.0.1-debian7

Modifier `Makefile.openmpi-1.6.4-intel-14.0.1-debian7 <../../_static/Plateformes/Liens/Makefile.openmpi-1.6.4-intel-14.0.1-debian7>`_

.. code-block:: bash

    CC =            mpic++
    CCFLAGS =       -O2 
    LINK =          mpic++
    MPI_INC, MPI_PATH, MPI_LIB = 
    FFT_INC, FFT_PATH, FFT_LIB = 

Pour `les paquets additionnels CLASS2, MOLECULE, RIGID,USER-CG-CMM, USER-OMP <../../_static/Plateformes/Liens/les_paquets_additionnels_CLASS2__MOLECULE__RIGID_USER-CG-CMM__USER-OMP>`_

.. code-block:: bash

    $ make yes-class2
    $ make yes-molecule 
    $ make yes-rigid
    $ make yes-user-cg-cmm
    $ make yes-user-omp 

.. code-block:: bash

    make openmpi-1.6.4-intel-14.0.1-debian7

Exemples d'utilisation au PSMN 
------------------------------

L' exemple décri le mode d'utilisation de LAMMPS en mode parallèle MPI.


- créer un répertoire de test et travailler dedans : 

.. code-block:: bash

    mkdir $HOME/Test_LAMMPS
    cd $HOME/Test_LAMMPS
     
- copier l'un des fichier test dans votre répertoire de test : 

.. code-block:: bash
    
    cp /applis/PSMN/debian9/software/Local/LAMMPS/15Nov2018/iomkl-2017.4-3.0.0/bench/in.lj .
     
- exécuter LAMMPS avec un script de soumission SGE et de soumettre ce script : 

.. code-block:: bash

    ccalugar@e5-2670comp1:~/Tests/Test_LAMMPS$ vi script_LAMMPS 
    #!/bin/bash
    #$ -S /bin/bash
    #$ -N Test_Lammps
    #$ -q E5_test
    #$ -pe test_debian 4
    #$ -cwd
    #$ -V
    HOSTFILE=${TMPDIR}/machines

    cd ${SGE_O_WORKDIR}

    ### configurer l'environnement
    module purge
    module load LAMMPS/15Nov2018-iomkl-2017.4-3.0.0

    ### au besoin, forcer l'env OpenMPI
    PREFIX="/applis/PSMN/debian9/software/Compiler/IntelComp/2017.4/Core/OpenMPI/3.0.0"
    MPIRUN="${PREFIX}/bin/mpirun"

    $MPIRUN -v -x LD_LIBRARY_PATH -hostfile ${HOSTFILE} -np ${NSLOTS} lammps < in.lj > lammps_in.log

    # fin

.. code-block:: bash

    ccalugar@e5-2670comp1:~/Tests/Test_LAMMPS$ qsub script_LAMMPS 
    Your job 2534457 ("Test_Lammps") has been submitted
    ccalugar@e5-2670comp1:~/Tests/Test_LAMMPS$ qstat
    job-ID  prior   name       user         state submit/start at     queue                          slots ja-task-ID 
    -----------------------------------------------------------------------------------------------------------------
    2534457 0.00000 Test_Lammp ccalugar     qw    03/27/2019 17:07:45                                    4        
    ccalugar@e5-2670comp1:~/Tests/Test_LAMMPS$ qstat
    job-ID  prior   name       user         state submit/start at     queue                          slots ja-task-ID 
    -----------------------------------------------------------------------------------------------------------------
    2534457 0.07384 Test_Lammp ccalugar     r     03/27/2019 17:07:55 E5_test@c8220node123               4        
    ccalugar@e5-2670comp1:~/Tests/Test_LAMMPS$ qstat
    job-ID  prior   name       user         state submit/start at     queue                          slots ja-task-ID 

    ccalugar@e5-2670comp1:~/Tests/Test_LAMMPS$ ls -ltr
    total 11
    -rw-r--r-- 1 ccalugar cbp  494 Mar 27 17:01 script_LAMMPS
    -rw-r--r-- 1 ccalugar cbp  470 Mar 27 17:08 in.lj
    -rw-r--r-- 1 ccalugar cbp    0 Mar 27 17:08 Test_Lammps.pe2534457
    -rw-r--r-- 1 ccalugar cbp    0 Mar 27 17:08 Test_Lammps.o2534457
    -rw-r--r-- 1 ccalugar cbp    0 Mar 27 17:08 Test_Lammps.e2534457
    -rw-r--r-- 1 ccalugar cbp 2602 Mar 27 17:08 log.lammps
    -rw-r--r-- 1 ccalugar cbp 2046 Mar 27 17:08 lammps_in.log
    -rw-r--r-- 1 ccalugar cbp   51 Mar 27 17:08 Test_Lammps.po2534457
   